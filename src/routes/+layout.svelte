<script lang="ts">
	import { applyAction, enhance } from '$app/forms';
	import { page } from '$app/stores';
	import { pb } from '$lib/pocketbase';
	import '../app.scss';

	import type { PageData } from './$types';

	export let data: PageData;
</script>

<header class="header">
	{#if data.user}
		<p>登记员：{data.user.username}</p>

		<form
			method="POST"
			action="/logout"
			use:enhance={() => {
				return async ({ result }) => {
					pb.authStore.clear();
					await applyAction(result);
				};
			}}
		>
			<button class="action-btn">登出</button>
		</form>
		<a class="action-btn" href="/record">登记入口</a>
	{:else if !($page.url.pathname === '/login')}
		<a class="action-btn" href="/login">登记员登陆</a>
	{/if}
</header>

<div class="">
	<slot />
</div>

<div class="wm">
	<svg width="267" height="44" viewBox="0 0 267 44" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path
			d="M44.544 33.744H41.376C41.12 34.544 40.8 35.296 40.416 36C40.192 36.384 39.904 36.72 39.552 37.008C39.104 37.36 38.592 37.616 38.016 37.776C37.312 37.904 36.608 37.952 35.904 37.92H31.776C31.168 37.952 30.576 37.904 30 37.776C29.712 37.68 29.44 37.536 29.184 37.344C28.864 37.088 28.656 36.768 28.56 36.384C28.432 35.904 28.384 35.408 28.416 34.896V21.984H23.376L23.664 20.688H43.728V16.08H24.384C24.512 14.928 24.592 13.744 24.624 12.528C24.656 10.832 24.704 9.136 24.768 7.44H40.896V2.832H4.608V7.44H17.808C17.744 9.04 17.68 10.608 17.616 12.144C17.52 13.488 17.408 14.8 17.28 16.08H1.824V20.688H16.512C15.488 25.104 13.52 29.04 10.608 32.496C9.424 33.84 8.144 35.088 6.768 36.24C4.624 37.936 2.368 39.472 0 40.848L1.488 43.92C4.112 42.768 6.672 41.456 9.168 39.984C10.736 39.056 12.256 38.016 13.728 36.864C17.184 34.144 19.84 30.8 21.696 26.832V36.192C21.664 37.056 21.744 37.904 21.936 38.736C22.16 39.568 22.56 40.304 23.136 40.944C23.808 41.52 24.56 41.92 25.392 42.144C26.48 42.4 27.6 42.528 28.752 42.528H36.624C37.84 42.528 39.024 42.336 40.176 41.952C40.848 41.696 41.424 41.312 41.904 40.8C42.608 39.968 43.12 39.056 43.44 38.064C43.888 36.656 44.256 35.216 44.544 33.744Z"
			fill="black"
		/>
		<path
			d="M70.944 0.576001C71.008 3.904 71.152 7.2 71.376 10.464L66.864 10.944L67.344 15.168L71.76 14.688L72.288 19.2L66.336 19.92L66.864 24.336L72.912 23.568C73.36 26.8 74.096 29.952 75.12 33.024C71.824 35.296 68.336 37.12 64.656 38.496L65.52 41.568C69.488 40.64 73.248 39.136 76.8 37.056C77.024 37.568 77.296 38.048 77.616 38.496C78.544 40.064 79.712 41.424 81.12 42.576C82.304 43.472 83.632 43.92 85.104 43.92C85.616 43.888 86.128 43.776 86.64 43.584C87.344 43.232 87.984 42.736 88.56 42.096C89.296 41.264 89.952 40.368 90.528 39.408C91.328 38.096 92.08 36.736 92.784 35.328H90.096C89.456 36.352 88.688 37.248 87.792 38.016C87.184 38.464 86.512 38.672 85.776 38.64C85.072 38.576 84.448 38.304 83.904 37.824C83.36 37.376 82.928 36.832 82.608 36.192C82.16 35.456 81.792 34.688 81.504 33.888C84.832 31.36 87.888 28.496 90.672 25.296L86.928 22.224C84.816 24.784 82.512 27.136 80.016 29.28C79.44 27.168 78.992 25.024 78.672 22.848L92.112 21.12L91.68 16.8L78.096 18.48C77.904 17.008 77.744 15.52 77.616 14.016L91.104 12.528L90.576 8.304L77.328 9.792C77.104 6.72 76.928 3.616 76.8 0.48L70.944 0.576001ZM49.728 26.208L51.072 30.768C55.584 29.552 60.128 28.368 64.704 27.216V24.144L55.344 25.584C56.272 24.848 57.152 24.032 57.984 23.136C59.2 21.824 60.304 20.432 61.296 18.96C63.28 15.984 65.072 12.864 66.672 9.6L61.728 7.488C60.704 9.472 59.68 11.44 58.656 13.392L53.568 13.632C54.304 13.216 54.992 12.72 55.632 12.144C56.592 11.216 57.456 10.224 58.224 9.168C59.792 6.928 61.136 4.544 62.256 2.016L56.832 0.0959988C55.04 4.256 53.008 8.256 50.736 12.096C50.224 12.896 49.536 13.472 48.672 13.824L49.968 18.24C52.24 17.856 54.512 17.392 56.784 16.848C55.44 19.248 54.08 21.616 52.704 23.952C52.064 25.2 51.072 25.952 49.728 26.208ZM48.48 36.816L49.392 41.328C52.336 40.528 55.264 39.632 58.176 38.64C60.416 37.904 62.624 37.04 64.8 36.048L64.368 32.832C59.088 34.24 53.792 35.568 48.48 36.816ZM77.664 3.024C79.808 5.776 82.576 7.648 85.968 8.64L87.408 6.768C85.392 4.656 83.408 2.528 81.456 0.384001L77.664 3.024Z"
			fill="black"
		/>
		<path
			d="M99.264 6.528V33.024H114.384V35.856C114.352 37.072 114.496 38.256 114.816 39.408C115.008 40.048 115.344 40.624 115.824 41.136C116.528 41.808 117.36 42.24 118.32 42.432C119.664 42.688 121.024 42.816 122.4 42.816H132.816C134.096 42.816 135.36 42.64 136.608 42.288C137.312 42.032 137.968 41.664 138.576 41.184C139.376 40.416 139.984 39.536 140.4 38.544C140.976 37.2 141.44 35.792 141.792 34.32H138.528C138.304 34.992 138.016 35.632 137.664 36.24C137.312 36.816 136.832 37.28 136.224 37.632C135.584 37.92 134.928 38.096 134.256 38.16C133.328 38.224 132.416 38.24 131.52 38.208H124.368C123.76 38.24 123.184 38.192 122.64 38.064C122.224 37.968 121.856 37.776 121.536 37.488C121.344 37.264 121.2 36.992 121.104 36.672C120.944 36.128 120.88 35.568 120.912 34.992V33.024H129.744C130.768 33.056 131.792 32.96 132.816 32.736C133.584 32.544 134.304 32.24 134.976 31.824C135.968 30.992 136.464 29.92 136.464 28.608V6.528H120.912V0.816001H114.384V6.528H99.264ZM120.912 28.608V21.888H129.744V28.608H120.912ZM129.744 10.944V17.568H120.912V10.944H129.744ZM105.792 21.888H114.384V28.608H105.792V21.888ZM105.792 10.944H114.384V17.568H105.792V10.944Z"
			fill="black"
		/>
		<path
			d="M172.176 0.287999V13.968H164.304V18.768H172.176V36.912H161.28V41.712H188.496V36.912H178.8V18.768H187.104V13.968H178.8V0.287999H172.176ZM149.664 1.296C149.984 2.256 150.352 3.2 150.768 4.128C151.152 4.896 151.616 5.6 152.16 6.24C153.216 7.424 154.464 8.336 155.904 8.976H145.824V13.632H154.944C153.376 16.416 151.664 19.088 149.808 21.648C147.888 24.176 145.776 26.512 143.472 28.656L144.432 31.92C146.736 30.864 148.896 29.536 150.912 27.936V43.392H154.032C154.832 43.392 155.552 43.12 156.192 42.576C156.864 41.904 157.2 41.088 157.2 40.128V25.728C158.32 26.752 159.536 27.648 160.848 28.416C162.064 29.12 163.36 29.616 164.736 29.904L166.128 27.408C163.472 24.944 160.848 22.432 158.256 19.872C159.632 17.888 160.88 15.808 162 13.632V8.976H156.768L158.448 8.208L155.472 0L149.664 1.296Z"
			fill="black"
		/>
		<path
			d="M194.16 2.016V42.72H228.72C229.52 42.72 230.304 42.656 231.072 42.528C231.904 42.368 232.688 42.08 233.424 41.664C234.704 40.8 235.344 39.584 235.344 38.016V2.016H194.16ZM200.88 6.72H228.72V38.016H200.88V6.72ZM201.6 29.76L202.896 32.208C205.712 31.152 208.368 29.776 210.864 28.08C213.328 26.384 215.488 24.336 217.344 21.936V28.32C217.344 28.832 217.312 29.344 217.248 29.856C217.184 30.176 217.056 30.464 216.864 30.72C216.704 30.88 216.512 30.992 216.288 31.056C215.84 31.184 215.392 31.232 214.944 31.2L210.624 30.96V33.216C211.488 33.952 212.448 34.528 213.504 34.944C214.336 35.264 215.2 35.408 216.096 35.376C217.28 35.408 218.448 35.312 219.6 35.088C220.432 34.928 221.184 34.592 221.856 34.08C222.272 33.664 222.592 33.2 222.816 32.688C223.136 31.824 223.296 30.912 223.296 29.952V17.472H227.424V13.056H223.296V8.64H217.344V13.056H203.952V17.472H214.32C210.992 22.528 206.752 26.624 201.6 29.76Z"
			fill="black"
		/>
		<path
			d="M255.341 1.7696C252.374 1.7696 249.84 2.8064 247.766 4.88C245.693 6.9536 244.656 9.488 244.656 12.4544C244.656 15.392 245.693 17.9264 247.766 20.0288C249.84 22.1024 252.374 23.1392 255.341 23.1392C258.278 23.1392 260.813 22.1024 262.915 20.0288C264.989 17.9264 266.026 15.392 266.026 12.4544C266.026 9.488 264.989 6.9536 262.915 4.88C260.813 2.8064 258.278 1.7696 255.341 1.7696ZM255.341 3.5264C257.789 3.5264 259.891 4.3904 261.648 6.1472C263.376 7.8752 264.269 9.9776 264.269 12.4544C264.269 14.9024 263.376 17.0048 261.648 18.7616C259.891 20.4896 257.789 21.3824 255.341 21.3824C252.864 21.3824 250.762 20.4896 249.034 18.7616C247.277 17.0048 246.413 14.9024 246.413 12.4544C246.413 9.9776 247.277 7.8752 249.034 6.1472C250.762 4.3904 252.864 3.5264 255.341 3.5264ZM250.128 6.0896V18.8192H252.95V13.9232H255.139C255.974 13.9232 256.55 14.1248 256.896 14.5568C257.126 14.8736 257.299 15.4784 257.414 16.4C257.53 17.4944 257.731 18.3008 258.077 18.8192H261.274C260.64 18.1856 260.266 17.2064 260.208 15.8816C260.15 15.1328 260.035 14.4992 259.805 14.0384C259.517 13.376 259.056 12.944 258.422 12.7712C259.69 12.2528 260.352 11.3024 260.352 9.8912C260.352 8.624 259.891 7.6448 259.027 6.9824C258.221 6.3776 257.098 6.0896 255.715 6.0896H250.128ZM252.95 8.4512H255.427C256.81 8.4512 257.53 8.9408 257.53 9.9776C257.53 10.496 257.357 10.8704 257.011 11.1584C256.637 11.3888 256.118 11.5328 255.427 11.5328H252.95V8.4512Z"
			fill="black"
		/>
	</svg>
</div>

<style lang="scss">
	:global(body) {
		font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
			'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji',
			'Segoe UI Symbol', 'Noto Color Emoji';
		font-size: 16px;
	}

	.header {
		display: flex;
		flex-direction: row;
		justify-content: center;
		align-items: center;

		gap: 1rem;

		position: fixed;
		top: 0;
		right: 0;
		margin: 1rem;

		z-index: 100;

		opacity: 0.2;
	}

	.header:hover {
		opacity: 1;
	}

	.action-btn {
		color: #000;
		text-decoration: none;

		padding: 0.5rem;
		border: 1px solid #ccc;
		border-radius: 0.25rem;
		background-color: hsla(0, 0%, 100%, 0.5);
		backdrop-filter: blur(0.5rem);
		cursor: pointer;

		transition: background-color 0.15s ease-in-out;
		&:hover {
			background-color: #eee;
		}
		&:active {
			background-color: #ddd;
		}
		&:focus,
		&:active {
			outline: #0be5ff solid 1px;
		}
	}
	.wm {
		position: fixed;
		bottom: 0;
		right: 0;
		margin: 1rem;
		z-index: 100;
	}
</style>
